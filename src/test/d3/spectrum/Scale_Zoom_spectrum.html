
<html>  
<head>  
	<meta charset="utf-8">  
	<title>A simple specctrum</title>  
</head> 

<style>
	.axis path,
	.axis line{
		fill: none;
		stroke: black;
		shape-rendering: crispEdges;
	}

	.axis text {
		font-family: sans-serif;
		font-size: 11px;
	}

	.MyPeak {
		/*stroke: steelblue;*/
		/*stroke-width: 1;*/
	}

	.MyText {
		fill: red;
		text-anchor: middle;
		font-size: 10px;
	}

	.container{
	    height:80%;
	    width:80%;
	}

/*	svg{
	    height:100%;
	    width:100%;
	}*/
</style>

<body>  
	<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>  
	<script>

	//画布大小
	var width = 1000;
	var height = 300;

	var x,y,s;

	var zoom = d3.behavior.zoom()
		.translate([0, 0])
		.scaleExtent([1, 100000000])
		.scale(1)
		.on("zoom", zoomed);

	// //开启拖动
	// var drag = d3.behavior.drag()
	//     .on("dragstart", dragstarted)
	//     .on("drag", dragged)
	//     .on("dragend", dragended);
	// var dragx = 0

	var container = d3.select("body")
		.append("g")
		.attr("class", "container");

	//在 body 里添加一个 SVG 画布	
	var svg = d3.select(".container").append("svg")
        .attr("preserveAspectRatio", "xMidYMin meet")
        .attr("viewBox", "0 0 "+width+" "+height)
		.attr("width", "100%")
		.attr("height", "100%")
      	// .call(drag);
        // .on("click", function(d){
        // 	// body...
        // 	console.log(d3.event);
        // 	init();
        // })
        .call(zoom)
        .on('dblclick.zoom', init)
        .on('mousedown', function(){
			svg.attr("cursor","move");
        })
        .on('mouseup', function(){
			svg.attr("cursor","default");
        });

	//画布周边的空白
	var padding = {left:60, right:30, top:20, bottom:20};

	//定义一个数组
	// var peakmass = [752.7817,766.4563,814.558,832.4914,864.6902,888.4242,923.6401,937.1598,953.053,1454.5432,1464.6161,1547.9179,1732.1462,1764.8548,1777.7915,1963.8656,2110.9331,2221.9646,2238.9912,2296.0119,2324.6227,2357.6359,2392.9009,2407.0436,2424.07,2442.92,2535.1022,2552.1298,2602.0416,2629.4498,2701.4759,2701.4763,2738.206,2738.2075,2979.305,3000.4588,3067.4939,3265.5939,3321.5994,3470.0359,3487.0205,3503.7595,4136.2308,4331.3764,4384.2798,4453.9743,4467.6667,4481.2568,4539.2264,4635.2219,4657.7263,4828.7933,4892.86,4966.9111,5324.1667,5338.3756,5362.7099,5442.5524,5457.6644,5655.5473,5672.8311,5688.9262,5752.886,5792.3173,5802.0052,5819.016,6113.0321,6174.3227,6474.8987,6676.1136,7076.4701,7141.7051,7210.3451,7398.4647,7914.0441,7954.7249,8042.8996,8085.9504,8111.6089,8143.4657,8262.5867,8294.5107,8325.4157,8659.3297,8678.1685,8766.2014,8868.227,8900.2894,8928.3728,8944.3478,8945.3439,8995.3184,9012.3337,9039.3624,9057.3878,9058.4034,9073.4205,9074.4153,9097.3521,9111.3825,9141.3782,9141.3924,9142.4074,9156.4373,9168.4311,9171.4289,9185.4529,9186.4431,9187.4457,9201.4211,9201.478,9265.4638,9283.4729,9312.4915,9325.4525,9327.5072,9343.5388,9371.5356,9372.5299,9388.5546,9388.562,9404.449,9441.5281,9455.5225,9455.5476,9483.5592,9483.5766,9500.5895,9500.5909,9513.5883,9514.5912,9539.5411,9566.6701,9583.5868,9583.6072,9598.6065,9611.5932,9611.6186,9628.6437,9628.6445,9642.6323,9668.6512,9685.6639,9685.6646,9700.6701,9731.6545,9734.6321,9796.7089,9813.722,9813.7249,9871.2204,9915.7517,9943.7752,9959.7844,9960.7867,10136.8096,10210.0236,10238.9832,10304.9059,10331.9535,10377.0949,10540.5461,10658.4473,10676.177,10690.0887,10736.0028,10742.3346,10762.2106,10860.9253,11277.6634,11369.5041,11395.4354,11493.1488,11522.4916,11559.4995,11643.5097,11680.5342,11695.5154,11722.5612,11739.5729,11752.5793,11794.5888,11810.6016,11902.6384];
	// var peakintensity = [753.7889,767.4636,815.5653,833.4987,865.6975,889.4315,924.6474,938.1671,954.0602,728.2789,1465.6234,774.9662,867.0804,883.4347,889.903,982.9401,1056.4738,1111.9896,1120.5029,1149.0132,775.8815,786.8859,798.6409,1204.5291,1213.0423,815.314,1268.5584,1277.0722,868.3545,877.4905,676.3762,901.4994,913.7426,1370.111,994.1089,751.122,1023.5052,1089.5386,831.4071,868.5163,872.7624,876.9471,828.2534,867.2826,877.8632,891.8021,894.5406,897.2586,908.8526,773.5443,932.5525,805.8062,816.4839,828.8258,888.3684,890.7366,767.1087,908.0993,910.618,808.9426,811.4117,949.1616,959.8216,828.4812,968.0081,970.8433,874.2976,883.0534,925.9928,835.5215,885.566,794.5301,902.3004,823.0589,880.3455,884.8656,894.6628,899.4462,902.2972,815.3538,827.2659,830.4583,833.5488,866.9402,789.9317,797.9347,887.83,810.1245,812.6775,814.1298,746.4526,750.6171,820.3103,822.7675,824.4062,755.8742,825.8637,757.2085,828.0393,760.2891,915.1451,832.0429,762.8746,764.0437,834.501,765.293,766.4617,836.1385,919.7518,837.5001,767.7971,773.1293,774.63,777.0482,933.5525,778.2995,779.6355,852.9651,782.0514,783.3868,854.5129,855.9572,787.8013,788.9675,860.6025,791.3039,863.1506,792.7231,864.6974,865.8789,793.8899,795.969,870.7046,799.6395,872.2443,800.8911,874.7885,801.9755,876.3385,803.3943,804.56,806.7282,808.1459,881.5222,809.3965,811.9785,885.9738,817.3997,818.8174,893.1641,898.3909,827.3199,829.6552,830.9893,906.5333,780.7619,929.1912,931.8239,859.7494,862.0034,865.7652,879.3861,889.2112,890.6887,891.848,826.8536,896.2018,897.8582,906.0844,868.5198,875.5845,877.5792,885.0956,887.3528,890.1995,896.6619,899.5099,900.6623,902.7428,904.0513,905.0518,908.2833,909.5151,851.1957];
	// var notesmass = [1464.6161,1777.7915,1963.8656,2110.9331,2238.9912,2296.0119,2424.07,2552.1298,2738.206,2738.2075,6113.0321,6676.1136,8944.3478,9057.3878,9058.4034,9185.4529,9186.4431,9283.4729,9371.5356,9372.5299,9500.5895,9500.5909,9628.6437,9628.6445,9685.6639,9685.6646,9813.722,9813.7249,9959.7844,9960.7867,10136.8096,10331.9535,10742.3346,11395.4354,11522.4916];
	// var notesintensity = [1465.6234,889.903,982.9401,1056.4738,1120.5029,1149.0132,1213.0423,1277.0722,913.7426,1370.111,874.2976,835.5215,814.1298,824.4062,755.8742,766.4617,836.1385,774.63,852.9651,782.0514,792.7231,864.6974,876.3385,803.3943,808.1459,881.5222,818.8174,893.1641,830.9893,906.5333,780.7619,862.0034,896.2018,877.5792,887.3528];
	// var notestype = ["Y11","Y14","Y15","Y16","Y17","Y18","Y19","Y20","Y21","Y21","B60","Y55","B84","B85","B85","B86","B86","Y80","B87","B87","B88","B88","B89","B89","B90","B90","B91","B91","B92","B92","Y90","B95","B98","B103","B104"];
	// // //x轴的比例尺
	// // var xScale = d3.scale.ordinal()
	// // 	.domain(d3.range(0,d3.max(peakmass),Math.round(d3.max(peakmass)/10)))
	// // 	.rangeRoundBands([0, width - padding.left - padding.right]);

	// function convertData() {
	// 	var i = notesmass.length;
	// 	var peak = [];
	// 	var s = "";
	// 	while(i--) {
	// 		peak[i] = [];
	// 		peak[i][1]=notesmass[i];
	// 		peak[i][2]=notesintensity[i];
	// 		peak[i][3]=notestype[i];
	// 		s = s + ",["+peak[i][1]+","+peak[i][2]+",\""+peak[i][3]+"\"]"
	// 	}
	// 	console.log(peak);
	// 	console.log(s);
	// }
	// convertData();
	var peakData = [[11810.6016,909.5151],[11794.5888,908.2833],[11752.5793,905.0518],[11739.5729,904.0513],[11722.5612,902.7428],[11695.5154,900.6623],[11680.5342,899.5099],[11643.5097,896.6619],[11559.4995,890.1995],[11522.4916,887.3528],[11493.1488,885.0956],[11395.4354,877.5792],[11369.5041,875.5845],[11277.6634,868.5198],[10860.9253,906.0844],[10762.2106,897.8582],[10742.3346,896.2018],[10736.0028,826.8536],[10690.0887,891.848],[10676.177,890.6887],[10658.4473,889.2112],[10540.5461,879.3861],[10377.0949,865.7652],[10331.9535,862.0034],[10304.9059,859.7494],[10238.9832,931.8239],[10210.0236,929.1912],[10136.8096,780.7619],[9960.7867,906.5333],[9959.7844,830.9893],[9943.7752,829.6552],[9915.7517,827.3199],[9871.2204,898.3909],[9813.7249,893.1641],[9813.722,818.8174],[9796.7089,817.3997],[9734.6321,885.9738],[9731.6545,811.9785],[9700.6701,809.3965],[9685.6646,881.5222],[9685.6639,808.1459],[9668.6512,806.7282],[9642.6323,804.56],[9628.6445,803.3943],[9628.6437,876.3385],[9611.6186,801.9755],[9611.5932,874.7885],[9598.6065,800.8911],[9583.6072,872.2443],[9583.5868,799.6395],[9566.6701,870.7046],[9539.5411,795.969],[9514.5912,793.8899],[9513.5883,865.8789],[9500.5909,864.6974],[9500.5895,792.7231],[9483.5766,863.1506],[9483.5592,791.3039],[9455.5476,860.6025],[9455.5225,788.9675],[9441.5281,787.8013],[9404.449,855.9572],[9388.562,854.5129],[9388.5546,783.3868],[9372.5299,782.0514],[9371.5356,852.9651],[9343.5388,779.6355],[9327.5072,778.2995],[9325.4525,933.5525],[9312.4915,777.0482],[9283.4729,774.63],[9265.4638,773.1293],[9201.478,767.7971],[9201.4211,837.5001],[9187.4457,919.7518],[9186.4431,836.1385],[9185.4529,766.4617],[9171.4289,765.293],[9168.4311,834.501],[9156.4373,764.0437],[9142.4074,762.8746],[9141.3924,832.0429],[9141.3782,915.1451],[9111.3825,760.2891],[9097.3521,828.0393],[9074.4153,757.2085],[9073.4205,825.8637],[9058.4034,755.8742],[9057.3878,824.4062],[9039.3624,822.7675],[9012.3337,820.3103],[8995.3184,750.6171],[8945.3439,746.4526],[8944.3478,814.1298],[8928.3728,812.6775],[8900.2894,810.1245],[8868.227,887.83],[8766.2014,797.9347],[8678.1685,789.9317],[8659.3297,866.9402],[8325.4157,833.5488],[8294.5107,830.4583],[8262.5867,827.2659],[8143.4657,815.3538],[8111.6089,902.2972],[8085.9504,899.4462],[8042.8996,894.6628],[7954.7249,884.8656],[7914.0441,880.3455],[7398.4647,823.0589],[7210.3451,902.3004],[7141.7051,794.5301],[7076.4701,885.566],[6676.1136,835.5215],[6474.8987,925.9928],[6174.3227,883.0534],[6113.0321,874.2976],[5819.016,970.8433],[5802.0052,968.0081],[5792.3173,828.4812],[5752.886,959.8216],[5688.9262,949.1616],[5672.8311,811.4117],[5655.5473,808.9426],[5457.6644,910.618],[5442.5524,908.0993],[5362.7099,767.1087],[5338.3756,890.7366],[5324.1667,888.3684],[4966.9111,828.8258],[4892.86,816.4839],[4828.7933,805.8062],[4657.7263,932.5525],[4635.2219,773.5443],[4539.2264,908.8526],[4481.2568,897.2586],[4467.6667,894.5406],[4453.9743,891.8021],[4384.2798,877.8632],[4331.3764,867.2826],[4136.2308,828.2534],[3503.7595,876.9471],[3487.0205,872.7624],[3470.0359,868.5163],[3321.5994,831.4071],[3265.5939,1089.5386],[3067.4939,1023.5052],[3000.4588,751.122],[2979.305,994.1089],[2738.2075,1370.111],[2738.206,913.7426],[2701.4763,901.4994],[2701.4759,676.3762],[2629.4498,877.4905],[2602.0416,868.3545],[2552.1298,1277.0722],[2535.1022,1268.5584],[2442.92,815.314],[2424.07,1213.0423],[2407.0436,1204.5291],[2392.9009,798.6409],[2357.6359,786.8859],[2324.6227,775.8815],[2296.0119,1149.0132],[2238.9912,1120.5029],[2221.9646,1111.9896],[2110.9331,1056.4738],[1963.8656,982.9401],[1777.7915,889.903],[1764.8548,883.4347],[1732.1462,867.0804],[1547.9179,774.9662],[1464.6161,1465.6234],[1454.5432,728.2789],[953.053,954.0602],[937.1598,938.1671],[923.6401,924.6474],[888.4242,889.4315],[864.6902,865.6975],[832.4914,833.4987],[814.558,815.5653],[766.4563,767.4636],[752.7817,753.7889]]
	var annotationData = [[11522.4916,887.3528,"B104"],[11395.4354,877.5792,"B103"],[10742.3346,896.2018,"B98"],[10331.9535,862.0034,"B95"],[10136.8096,780.7619,"Y90"],[9960.7867,906.5333,"B92"],[9959.7844,830.9893,"B92"],[9813.7249,893.1641,"B91"],[9813.722,818.8174,"B91"],[9685.6646,881.5222,"B90"],[9685.6639,808.1459,"B90"],[9628.6445,803.3943,"B89"],[9628.6437,876.3385,"B89"],[9500.5909,864.6974,"B88"],[9500.5895,792.7231,"B88"],[9372.5299,782.0514,"B87"],[9371.5356,852.9651,"B87"],[9283.4729,774.63,"Y80"],[9186.4431,836.1385,"B86"],[9185.4529,766.4617,"B86"],[9058.4034,755.8742,"B85"],[9057.3878,824.4062,"B85"],[8944.3478,814.1298,"B84"],[6676.1136,835.5215,"Y55"],[6113.0321,874.2976,"B60"],[2738.2075,1370.111,"Y21"],[2738.206,913.7426,"Y21"],[2552.1298,1277.0722,"Y20"],[2424.07,1213.0423,"Y19"],[2296.0119,1149.0132,"Y18"],[2238.9912,1120.5029,"Y17"],[2110.9331,1056.4738,"Y16"],[1963.8656,982.9401,"Y15"],[1777.7915,889.903,"Y14"],[1464.6161,1465.6234,"Y11"]]


	var peakmass = [];
	var peakintensity = [];
	var notesmass = [];
	var notesintensity = [];
	var notestype = [];
	function convertData() {
		var i = peakData.length;
		while(i--) {
			peakmass[i] = peakData[i][0];
			peakintensity[i] = peakData[i][1];
		}
		i = annotationData.length;
		while(i--) {
			notesmass[i] = annotationData[i][0];
			notesintensity[i] = annotationData[i][1];
			notestype[i] = annotationData[i][2];
		}
		console.log(peakmass);
		console.log(peakintensity);
		console.log(notesmass);
		console.log(notesintensity);
		console.log(notestype);
	}
	convertData();


	var xDomain = d3.max(peakmass) * 1.1 - d3.min(peakmass) * 0.1
	var xRange = width - padding.left - padding.right
	//x轴的比例尺
	var xScale = d3.scale.linear()
		.domain([0,xDomain])
		.range([0, xRange]);
	//y轴的比例尺
	var yScale = d3.scale.linear()
		.domain([0,d3.max(peakintensity)*4/3])
		.range([height - padding.top - padding.bottom, 0]);

	//定义x轴
	var xAxis = d3.svg.axis()
		.scale(xScale)
		.orient("bottom")
        .ticks(10);
		
	//定义y轴
	var yAxis = d3.svg.axis()
		.scale(yScale)
		.orient("left");


	//添加peaks元素
	var peaks = svg.selectAll(".MyPeak")
		.data(peakmass)
		.enter()
		.append("line")
		.attr("class","MyPeak")
		.attr("transform","translate(" + padding.left + "," + padding.top + ")")
		.attr("x1",function(d,i){
			return xScale(d);
		} )
		.attr("y1",function(d,i){
			return yScale(peakintensity[i]);
		})
		.attr("x2",function(d,i){
			return xScale(d);
		})
		.attr("y2",height - padding.bottom - padding.top)
		.attr("stroke",function(d,i){
			if(notesmass.indexOf(d) != -1){
				return "steelblue";
			}else{
				return "black";
			}
		})
		.attr("stroke-width","2")
		.on("mouseover",function(d,i){
			over(d3.select(this));
		})
		.on("mouseout",function(d,i){
			out(this,d);
		});
      	// .call(drag);
	function over(select){
			select.attr("stroke","red")
				.attr("stroke-width","3");
	};
	function out(t,d){
		d3.select(t)
				.transition()
		        .duration(500)
				.attr("stroke",function(d){
					if(notesmass.indexOf(d) != -1){
						return "steelblue";
					}else{
						return "black";
					}
				})
				.attr("stroke-width","2");
	};

	//添加注释文字
	var textshiftx = 0;
	var textshifty = -5;
	var texts = svg.selectAll(".MyText")
		.data(notesmass)
		.enter()
		.append("text")
		.attr("class","MyText")
		.attr("transform","translate(" + (padding.left + textshiftx) + "," + (padding.top + textshifty) + ")")
		.attr("x", function(d,i){
			return xScale(d);
		} )
		.attr("y",function(d,i){
			return yScale(notesintensity[i]);
		})
		.text(function(d,i){
			return notestype[i];
		});
      	// .call(drag);

	//添加x轴
	svg.append("g")
		.attr("id","xAxis")
		.attr("class","axis")
		.attr("transform","translate(" + padding.left + "," + (height - padding.bottom) + ")")
		.call(xAxis); 
		
	//添加y轴
	svg.append("g")
		.attr("id","yAxis")
		.attr("class","axis")
		.attr("transform","translate(" + padding.left + "," + padding.top + ")")
		.call(yAxis);



	function zoomed() {
		s=d3.event.scale;
		x=d3.event.translate[0] + padding.left * (s - 1);
		y=d3.event.translate[1];
		console.log(d3.event);
		console.log(d3.event.translate);
		console.log(d3.event.scale);
		console.log("translate(" + d3.event.translate + ") scale(" + d3.event.scale + ")");
		// container.attr("transform", "translate(" + d3.event.translate[0] + ",0) scale(" + d3.event.scale + ")");

		reset();
	};

	function init() {
		d3.transition().duration(500).tween("zoom", function() {
		    var si = d3.interpolate(s, 1);
		    var xi = d3.interpolate(x - padding.left * (s - 1), 0);
		    var yi = d3.interpolate(y, 0);
		    return function(t){
		      svg.call(zoom.translate([xi(t),yi(t)]).scale(si(t)).event);
		 	}
  		});

	}

	function reset() {
	  	svg.selectAll(".MyText")
	  	.attr("x", function(d,i){
	  		var tmpx = xScale(d) * s + x;
	  		if (tmpx > 0 && tmpx < xRange){
	  			return tmpx;
	  		}else{
	  			return -100;
	  		}
	  	});
	  	svg.selectAll(".MyPeak")	
		.attr("x1",function(d,i){
	  		var tmpx = xScale(d) * s + x;
	  		if (tmpx > 0 && tmpx < xRange){
	  			return tmpx;
	  		}else{
	  			return -100;
	  		}
		} )
		.attr("x2",function(d,i){
	  		var tmpx = xScale(d) * s + x;
	  		if (tmpx > 0 && tmpx < xRange){
	  			return tmpx;
	  		}else{
	  			return -100;
	  		}
		});
		// var dragd = xDomain*x/(xRange*s);
		var dragd = xDomain*x/(xRange*s);
		//x轴的比例尺
		var xScale_new = d3.scale.linear()
			.domain([0-dragd,xDomain/s-dragd])
			.range([0, xRange]);
		//定义x轴
		var xAxis_new = d3.svg.axis()
			.scale(xScale_new)
			.orient("bottom")
        	.ticks(10);
		svg.select("#xAxis")
			.call(xAxis_new); 

	};

	// function scaleSVG(){
	// 	var svg = d3.select("body")
	// 	//定义一个数组
	// 	var peakmass_new = [752.7817,766.4563,814.558,832.4914];
	// 	var peakintensity_new = [753.7889,767.4636,815.5653,833.4987];
	// 	var notesmass_new = [766.4563];
	// 	var notesintensity_new = [767.4636];
	// 	var notestype_new = ["Y11"];

	// 	//x轴的比例尺
	// 	var xScale_new = d3.scale.linear()
	// 		.domain([0,d3.max(peakmass_new) * 1.1 - d3.min(peakmass_new) * 0.1])
	// 		.range([0, width - padding.left - padding.right]);
	// 	//y轴的比例尺
	// 	var yScale_new = d3.scale.linear()
	// 		.domain([0,d3.max(peakintensity_new)*4/3])
	// 		.range([height - padding.top - padding.bottom, 0]);

	// 	//定义x轴
	// 	var xAxis_new = d3.svg.axis()
	// 		.scale(xScale_new)
	// 		.orient("bottom");
			
	// 	//定义y轴
	// 	var yAxis_new = d3.svg.axis()
	// 		.scale(yScale_new)
	// 		.orient("left");

	// 	svg.select("#xAxis")
	// 		.call(xAxis_new);
	// 	svg.select("#yAxis")
	// 		.call(yAxis_new);
	// };
	// svg.on("click",function(){
	// 	scaleSVG();
	// });

</script>  
</body>  
</html>  